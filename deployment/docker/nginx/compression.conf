# Compression configuration for Candlefish frontend applications
# Optimized gzip and brotli compression for better performance

# Gzip compression
gzip on;
gzip_vary on;
gzip_min_length 256;
gzip_comp_level 6;
gzip_proxied any;
gzip_buffers 16 8k;
gzip_http_version 1.1;

# Gzip file types
gzip_types
    application/atom+xml
    application/geo+json
    application/javascript
    application/json
    application/ld+json
    application/manifest+json
    application/rdf+xml
    application/rss+xml
    application/vnd.ms-fontobject
    application/wasm
    application/x-font-ttf
    application/x-javascript
    application/x-web-app-manifest+json
    application/xhtml+xml
    application/xml
    font/collection
    font/eot
    font/opentype
    font/otf
    font/ttf
    image/bmp
    image/svg+xml
    image/vnd.microsoft.icon
    image/x-icon
    text/cache-manifest
    text/calendar
    text/css
    text/html
    text/javascript
    text/json
    text/markdown
    text/plain
    text/vcard
    text/vnd.rim.location.xloc
    text/vtt
    text/x-component
    text/x-cross-domain-policy
    text/xml;

# Brotli compression (if available)
# Note: Requires nginx-module-brotli
# brotli on;
# brotli_comp_level 4;
# brotli_min_length 256;
# brotli_types
#     application/atom+xml
#     application/javascript
#     application/json
#     application/ld+json
#     application/manifest+json
#     application/rss+xml
#     application/vnd.ms-fontobject
#     application/x-font-ttf
#     application/x-web-app-manifest+json
#     application/xhtml+xml
#     application/xml
#     font/opentype
#     image/svg+xml
#     image/x-icon
#     text/css
#     text/html
#     text/javascript
#     text/plain
#     text/x-component;

# Disable compression for already compressed files
location ~* \.(jpg|jpeg|png|gif|ico|webp|avif|mp4|mp3|flv|mov|avi|wmv|zip|gz|bz2|7z|rar)$ {
    gzip off;
    expires 1y;
    add_header Cache-Control "public, immutable";
}
