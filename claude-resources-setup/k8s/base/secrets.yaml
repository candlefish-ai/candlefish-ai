apiVersion: v1
kind: Secret
metadata:
  name: claude-resources-secrets
  namespace: claude-resources
type: Opaque
stringData:
  # Database configuration
  DATABASE_URL: "postgresql://postgres:password@postgres:5432/claude_resources"
  POSTGRES_USER: "postgres"
  POSTGRES_PASSWORD: "REPLACE_IN_PRODUCTION"
  POSTGRES_DB: "claude_resources"

  # Redis configuration
  REDIS_URL: "redis://redis:6379"

  # Application secrets
  JWT_SECRET: "REPLACE_WITH_STRONG_SECRET"
  API_SECRET_KEY: "REPLACE_WITH_STRONG_SECRET"
  ENCRYPTION_KEY: "REPLACE_WITH_32_BYTE_KEY"

  # External API keys (managed via External Secrets Operator)
  ANTHROPIC_API_KEY: "REPLACE_FROM_AWS_SECRETS_MANAGER"
  OPENAI_API_KEY: "REPLACE_FROM_AWS_SECRETS_MANAGER"
  GITHUB_TOKEN: "REPLACE_FROM_AWS_SECRETS_MANAGER"

  # AWS configuration
  AWS_ACCESS_KEY_ID: "REPLACE_FROM_AWS_SECRETS_MANAGER"
  AWS_SECRET_ACCESS_KEY: "REPLACE_FROM_AWS_SECRETS_MANAGER"
  AWS_REGION: "us-west-2"

  # Monitoring
  SENTRY_DSN: "REPLACE_FROM_AWS_SECRETS_MANAGER"

---
apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
  name: aws-secrets-manager
  namespace: claude-resources
spec:
  provider:
    aws:
      service: SecretsManager
      region: us-west-2
      auth:
        secretRef:
          accessKeyID:
            name: aws-credentials
            key: access-key-id
          secretAccessKey:
            name: aws-credentials
            key: secret-access-key

---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: claude-resources-external-secrets
  namespace: claude-resources
spec:
  refreshInterval: 15s
  secretStoreRef:
    name: aws-secrets-manager
    kind: SecretStore
  target:
    name: claude-resources-secrets
    creationPolicy: Merge
  data:
  - secretKey: ANTHROPIC_API_KEY
    remoteRef:
      key: claude-resources/anthropic
      property: api_key
  - secretKey: OPENAI_API_KEY
    remoteRef:
      key: claude-resources/openai
      property: api_key
  - secretKey: GITHUB_TOKEN
    remoteRef:
      key: claude-resources/github
      property: token
  - secretKey: SENTRY_DSN
    remoteRef:
      key: claude-resources/sentry
      property: dsn
