# Fluent Bit Configuration for Development Environment
# Aggregates logs from all Paintbox services

[SERVICE]
    Flush         1
    Log_Level     info
    Daemon        off
    Parsers_File  parsers.conf
    HTTP_Server   On
    HTTP_Listen   0.0.0.0
    HTTP_Port     2020

[INPUT]
    Name              forward
    Listen            0.0.0.0
    Port              24224
    Buffer_Chunk_Size 1M
    Buffer_Max_Size   6M

[INPUT]
    Name        tail
    Path        /var/log/paintbox/*.log
    Tag         paintbox.*
    Refresh_Interval 5
    Read_from_Head true
    Skip_Long_Lines on
    Buffer_Chunk_Size 1M
    Buffer_Max_Size 6M

[INPUT]
    Name        tail
    Path        /var/log/paintbox/health-monitor*.log
    Tag         paintbox.health
    Parser      json
    Refresh_Interval 5
    Read_from_Head true

[INPUT]
    Name        tail
    Path        /var/log/paintbox/dependency-checker*.log
    Tag         paintbox.dependencies
    Refresh_Interval 30
    Read_from_Head true

[FILTER]
    Name        grep
    Match       paintbox.*
    Regex       level (ERROR|WARN|INFO|DEBUG)

[FILTER]
    Name        record_modifier
    Match       paintbox.*
    Record      hostname ${HOSTNAME}
    Record      service paintbox-dev

[FILTER]
    Name        throttle
    Match       paintbox.*
    Rate        1000
    Window      300
    Interval    1s

[OUTPUT]
    Name        stdout
    Match       paintbox.*
    Format      json_lines

[OUTPUT]
    Name        file
    Match       paintbox.*
    Path        /var/log/paintbox/
    File        aggregated.log
    Format      template
    Template    [{time}] {level} {service}: {message}

# Development-specific outputs
[OUTPUT]
    Name        file
    Match       paintbox.health
    Path        /var/log/paintbox/
    File        health-aggregated.log
    Format      json_lines

[OUTPUT]
    Name        file
    Match       paintbox.dependencies
    Path        /var/log/paintbox/
    File        dependencies-aggregated.log
    Format      template
    Template    [{time}] DEPS: {message}