/* Candlefish AI Design System - Foundation CSS */
/* 2025 Edition - Advanced CSS Architecture */

/* Import our generated design tokens */
@import '../tokens/dist/css/candlefish-tokens.css';

/* ============================================================================
   CASCADE LAYERS - Establishes proper CSS precedence
   ============================================================================ */

@layer candlefish.reset, candlefish.tokens, candlefish.base, candlefish.components, candlefish.utilities, candlefish.adaptive;

/* ============================================================================
   RESET LAYER - Modern CSS reset with container query support
   ============================================================================ */

@layer candlefish.reset {
  *,
  *::before,
  *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  html {
    /* Enable smooth scrolling with respect for motion preferences */
    scroll-behavior: smooth;
    /* Improve text rendering */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
    /* Prevent horizontal overflow */
    overflow-x: hidden;
  }

  @media (prefers-reduced-motion: reduce) {
    html {
      scroll-behavior: auto;
    }
    
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }

  body {
    min-height: 100vh;
    font-family: var(--typography-font-family-sans);
    font-size: var(--typography-font-size-base);
    line-height: var(--typography-line-height-relaxed);
    color: var(--color-semantic-text-primary);
    background-color: var(--color-semantic-background-primary);
    /* Enable container queries globally */
    container-type: inline-size;
    container-name: viewport;
  }

  /* Focus management for accessibility */
  :focus {
    outline: var(--border-width-focus) solid var(--color-semantic-accent-focus);
    outline-offset: 2px;
  }

  :focus:not(:focus-visible) {
    outline: none;
  }

  /* Better focus for keyboard navigation */
  :focus-visible {
    outline: var(--border-width-focus) solid var(--color-semantic-accent-focus);
    outline-offset: 2px;
  }

  /* Improved button and interactive element resets */
  button,
  input,
  select,
  textarea {
    font: inherit;
    color: inherit;
  }

  button {
    background: none;
    border: none;
    cursor: pointer;
  }

  /* Image and media defaults */
  img,
  picture,
  video,
  canvas,
  svg {
    display: block;
    max-width: 100%;
    height: auto;
  }

  /* Typography improvements */
  h1, h2, h3, h4, h5, h6 {
    font-weight: var(--typography-font-weight-light);
    line-height: var(--typography-line-height-tight);
    text-wrap: balance;
  }

  p {
    text-wrap: pretty;
    max-width: 65ch;
  }

  /* List improvements */
  ul, ol {
    list-style: none;
  }

  /* Table improvements */
  table {
    border-collapse: collapse;
    border-spacing: 0;
  }
}

/* ============================================================================
   BASE LAYER - Foundational styles using design tokens
   ============================================================================ */

@layer candlefish.base {
  /* Root custom properties for advanced features */
  :root {
    /* Color scheme support */
    color-scheme: dark light;
    
    /* Container query context markers */
    --candlefish-component: false;
    --candlefish-context: root;
    
    /* Motion preference detection */
    --motion-safe: 1;
    --motion-reduce: 0;
  }

  @media (prefers-reduced-motion: reduce) {
    :root {
      --motion-safe: 0;
      --motion-reduce: 1;
    }
  }

  /* Advanced typography with OpenType features */
  body {
    font-feature-settings: var(--typography-font-features-default);
    font-variation-settings: 'wght' var(--typography-font-weight-regular);
  }

  /* Enhanced text selection */
  ::selection {
    background: var(--color-semantic-accent-primary);
    color: var(--color-semantic-text-inverse);
  }

  /* Improved scrollbar styling */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  ::-webkit-scrollbar-track {
    background: var(--color-semantic-background-secondary);
  }

  ::-webkit-scrollbar-thumb {
    background: var(--color-semantic-border-subtle);
    border-radius: var(--border-radius-full);
  }

  ::-webkit-scrollbar-thumb:hover {
    background: var(--color-semantic-border-default);
  }

  /* Container query support classes */
  .candlefish-container {
    container-type: inline-size;
    container-name: candlefish;
    --candlefish-component: true;
  }

  .candlefish-size-container {
    container-type: size;
    container-name: candlefish-size;
  }

  /* Grid pattern background */
  .candlefish-grid-pattern {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image: var(--effects-pattern-grid-subtle);
    background-size: 50px 50px;
    pointer-events: none;
    z-index: -1;
    opacity: calc(1 * var(--motion-safe));
    transition: opacity var(--motion-duration-normal) var(--motion-easing-candlefish-primary);
  }

  /* Neural network background pattern */
  .candlefish-neural-pattern {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image: var(--effects-pattern-neural-nodes);
    background-size: 200px 200px;
    pointer-events: none;
    z-index: -2;
    opacity: calc(0.3 * var(--motion-safe));
    animation: neural-drift 60s linear infinite;
    animation-play-state: calc(var(--motion-safe) * running + var(--motion-reduce) * paused);
  }

  @keyframes neural-drift {
    0% { transform: translate(0, 0); }
    25% { transform: translate(-10px, -10px); }
    50% { transform: translate(10px, -5px); }
    75% { transform: translate(-5px, 10px); }
    100% { transform: translate(0, 0); }
  }

  /* Glassmorphism utilities */
  .candlefish-glass {
    background: var(--color-semantic-background-elevated);
    border: 1px solid var(--color-semantic-border-subtle);
    backdrop-filter: var(--effects-backdrop-blur-candlefish);
    -webkit-backdrop-filter: var(--effects-backdrop-blur-candlefish);
  }

  .candlefish-glass-strong {
    background: var(--color-semantic-background-surface);
    border: 1px solid var(--color-semantic-border-default);
    backdrop-filter: var(--effects-backdrop-blur-lg);
    -webkit-backdrop-filter: var(--effects-backdrop-blur-lg);
  }

  /* Bioluminescent glow effects */
  .candlefish-glow {
    box-shadow: var(--motion-effects-shadow-glow-md);
    transition: box-shadow var(--motion-duration-normal) var(--motion-easing-candlefish-primary);
  }

  .candlefish-glow:hover {
    box-shadow: var(--motion-effects-shadow-glow-lg);
  }

  .candlefish-glow-pulse {
    animation: candlefish-pulse 4s ease-in-out infinite;
    animation-play-state: calc(var(--motion-safe) * running + var(--motion-reduce) * paused);
  }

  @keyframes candlefish-pulse {
    0%, 100% { 
      box-shadow: var(--motion-effects-shadow-glow-md);
      transform: scale(1);
    }
    50% { 
      box-shadow: var(--motion-effects-shadow-glow-pulse);
      transform: scale(1.02);
    }
  }

  /* Advanced typography classes */
  .candlefish-display {
    font-family: var(--typography-font-family-display);
    font-weight: var(--typography-font-weight-light);
    font-feature-settings: var(--typography-font-features-display);
    letter-spacing: var(--typography-letter-spacing-tight);
  }

  .candlefish-mono {
    font-family: var(--typography-font-family-mono);
    font-feature-settings: var(--typography-font-features-code);
    letter-spacing: var(--typography-letter-spacing-normal);
  }

  .candlefish-numeric {
    font-feature-settings: var(--typography-font-features-numeric);
    font-variant-numeric: tabular-nums;
  }
}

/* ============================================================================
   CONTAINER QUERIES - Responsive design with container queries
   ============================================================================ */

@layer candlefish.base {
  /* Container query breakpoints */
  @container candlefish (min-width: 320px) {
    .candlefish-responsive {
      --container-size: xs;
    }
  }

  @container candlefish (min-width: 480px) {
    .candlefish-responsive {
      --container-size: sm;
    }
  }

  @container candlefish (min-width: 768px) {
    .candlefish-responsive {
      --container-size: md;
    }
  }

  @container candlefish (min-width: 1024px) {
    .candlefish-responsive {
      --container-size: lg;
    }
  }

  @container candlefish (min-width: 1280px) {
    .candlefish-responsive {
      --container-size: xl;
    }
  }

  /* Container-based component sizing */
  @container candlefish (max-width: 479px) {
    .candlefish-adaptive-layout {
      grid-template-columns: 1fr;
      gap: var(--spacing-semantic-component-gap-sm);
      padding: var(--spacing-semantic-component-padding-sm);
    }
  }

  @container candlefish (min-width: 480px) and (max-width: 767px) {
    .candlefish-adaptive-layout {
      grid-template-columns: repeat(2, 1fr);
      gap: var(--spacing-semantic-component-gap-md);
      padding: var(--spacing-semantic-component-padding-md);
    }
  }

  @container candlefish (min-width: 768px) {
    .candlefish-adaptive-layout {
      grid-template-columns: repeat(3, 1fr);
      gap: var(--spacing-semantic-component-gap-lg);
      padding: var(--spacing-semantic-component-padding-lg);
    }
  }
}

/* ============================================================================
   VIEW TRANSITIONS API - Smooth page transitions
   ============================================================================ */

@layer candlefish.base {
  /* View transition root */
  html {
    view-transition-name: root;
  }

  /* Page transitions */
  ::view-transition-old(root),
  ::view-transition-new(root) {
    animation-duration: var(--motion-duration-slower);
    animation-timing-function: var(--motion-easing-candlefish-primary);
  }

  ::view-transition-old(root) {
    animation-name: slide-out;
  }

  ::view-transition-new(root) {
    animation-name: slide-in;
  }

  @keyframes slide-out {
    0% { transform: translateX(0); opacity: 1; }
    100% { transform: translateX(-100vw); opacity: 0; }
  }

  @keyframes slide-in {
    0% { transform: translateX(100vw); opacity: 0; }
    100% { transform: translateX(0); opacity: 1; }
  }

  /* Component transitions */
  .candlefish-view-transition {
    view-transition-name: candlefish-component;
  }

  ::view-transition-old(candlefish-component),
  ::view-transition-new(candlefish-component) {
    animation-duration: var(--motion-duration-normal);
    animation-timing-function: var(--motion-easing-candlefish-enter);
  }
}

/* ============================================================================
   ADAPTIVE THEMES - Environment-aware theming
   ============================================================================ */

@layer candlefish.adaptive {
  /* Light mode adaptations */
  @media (prefers-color-scheme: light) {
    :root {
      --color-semantic-background-primary: oklch(100% 0 0);
      --color-semantic-background-secondary: oklch(98% 0 0);
      --color-semantic-text-primary: oklch(0% 0 0);
      --color-semantic-text-secondary: oklch(25% 0 0);
      --color-semantic-border-default: oklch(0% 0 0 / 0.1);
    }
  }

  /* High contrast mode support */
  @media (prefers-contrast: high) {
    :root {
      --color-semantic-border-default: oklch(0% 0 0);
      --color-semantic-text-primary: oklch(0% 0 0);
      --color-semantic-background-primary: oklch(100% 0 0);
      --motion-effects-shadow-glow-md: none;
      --effects-backdrop-blur-candlefish: none;
    }
  }

  /* Reduced transparency for older devices */
  @media (prefers-reduced-transparency: reduce) {
    :root {
      --color-semantic-background-surface: var(--color-semantic-background-secondary);
      --color-semantic-background-elevated: var(--color-semantic-background-secondary);
      --effects-backdrop-blur-candlefish: none;
    }
  }

  /* Print styles */
  @media print {
    :root {
      --color-semantic-background-primary: white;
      --color-semantic-text-primary: black;
      --motion-effects-shadow-glow-md: none;
      --effects-backdrop-blur-candlefish: none;
    }

    .candlefish-grid-pattern,
    .candlefish-neural-pattern {
      display: none;
    }
  }
}

/* ============================================================================
   PERFORMANCE OPTIMIZATIONS
   ============================================================================ */

@layer candlefish.base {
  /* GPU acceleration for animations */
  .candlefish-accelerated {
    transform: translateZ(0);
    will-change: transform;
  }

  /* Optimize heavy animations */
  .candlefish-heavy-animation {
    contain: layout style paint;
    will-change: transform, opacity;
  }

  /* Optimize scrolling performance */
  .candlefish-scroll-container {
    overflow: auto;
    overscroll-behavior: contain;
    scroll-behavior: smooth;
  }

  @media (prefers-reduced-motion: reduce) {
    .candlefish-scroll-container {
      scroll-behavior: auto;
    }
  }
}